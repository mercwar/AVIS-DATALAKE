name: FIREGEM_V4_BOOTSTRAP
on: [push, workflow_dispatch]

jobs:
  bootstrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Initialize FVS Surface
        run: |
          echo "[REPLACEMENTS]" > string_registry.ini
          echo 'find=" "' >> string_registry.ini
          echo 'replace="%20"' >> string_registry.ini
          
          echo "[fire-gem]" > path.ini
          echo 'config="fire_gem_config.json"' >> path.ini

      - name: Forge V4 Engine
        timeout-minutes: 5
        run: |
          sudo apt-get update && sudo apt-get install -y nasm
          nasm -f elf64 engine/fire_gem.asm -o fire_gem.o
          ld fire_gem.o -o fire_gem
          chmod +x fire_gem
          ./fire_gem fire_gem_config.json
          
      - name: Stabilize and Upload .so
        run: |
          # 1. Run the Forge
          chmod +x forge/forge.sh
          ./forge/forge.sh
          
          # 2. Upload the new .so to the repo
          git config --local user.email "cvbgod@demonizer.com"
          git config --local user.name "CVBGOD"
          git add gemini/kb/so/*.so
          git commit -m "FIREGEM: Stabilization SO Uploaded"
          git push
