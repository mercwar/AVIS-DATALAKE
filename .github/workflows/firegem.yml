name: FIREGEM_V3_INSTALLATION
on: [push, workflow_dispatch]

jobs:
  install:
    runs-on: ubuntu-latest
    steps:
      - name: System Entry
        uses: actions/checkout@v4

      - name: Hard-Code V3 Surface
        run: |
          # 1. Force create the V3 Coordinate
          mkdir -p "gemini/install/v3"
          
          # 2. Inject the Hard-Coded FVS Table (fire-gem.ini)
          # Note: The spaces are locked as literal bytes here
          cat <<EOF > "gemini/install/v3/fire-gem.ini"
          [fire-gem]
          address="gemini/install/v3"
          guid="GUID_V3_8822_C4"
          status="FVS_V3_ACTIVE"
          cmd="echo s o s && mkdir -p dl/ui_components/v3"
          
          [fire-gem-next]
          next_dir="gemini/install/v3"
          deploy_mode="true"
          EOF
          
          echo "V3_SYNC: fire-gem.ini hard-coded at gemini/install/v3"

      - name: Spark V3 Forge
        run: |
          sudo apt-get update && sudo apt-get install -y nasm
          # Move to the V3 coordinate and ignite
          cd "gemini/install/v3"
          chmod +x forge.sh
          ./forge.sh fire-gem.ini
