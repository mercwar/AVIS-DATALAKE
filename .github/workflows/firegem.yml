name: Fire-Gem KB Loader
on: [push, workflow_dispatch]

jobs:
  kb-provision:
    runs-on: ubuntu-latest
    steps:
      - name: Sync Master Repo
        uses: actions/checkout@v4

      - name: Load INI and Install Gemini
        working-directory: AVIS-DATALAKE/fire-gem
        run: |
          # LOAD: Extract the Run GUID from fire-gem.ini
          # Using grep to find the key and cut to grab the value
          ACTIVE_GUID=$(grep "run_guid" fire-gem.ini | cut -d'=' -f2)
          echo "LOADED_GUID=$ACTIVE_GUID" >> $GITHUB_ENV
          
          # EXEC: Pass the loaded GUID to the orchestrator
          chmod +x fire-gem.sh
          ./fire-gem.sh "$ACTIVE_GUID"
