name: CVBGOD_SYSTEM_PURGE
on: 
  workflow_dispatch: # Allows you to trigger this manually to kill ghosts

jobs:
  purge_and_override:
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: write
    steps:
      - name: Force Checkout Clean
        uses: actions/checkout@v4
        with:
          clean: true # Deletes any files not tracked in the repo

      - name: Nuclear Purge
        run: |
          echo "FLAME ON: Purging ghost paths and empty KBs..."
          
          # 1. Force-kill any local directories from previous runs
          rm -rf dl/ ui_components/ .temp/ scripts/
          
          # 2. Delete all staging and legacy KB files
          rm -f staging_area.tmp initial_launch.kb initial_launch.sh worker_batch.sh
          
          # 3. Clear runner-level cache (if any)
          gh cache delete --all || true 
          
          echo "PURGE COMPLETE: Workspace is zeroed."
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Fresh Override
        run: |
          echo "REBUILDING SYSTEM: Injecting Hardened KB..."
          
          # Create the fresh directory structure
          mkdir -p dl/ui_components
          
          # Inject the new master KB (Not empty)
          echo "KB_ID: PURGE_RESTORE_V1" > dl/ui_components/active_interface.kb
          echo "STATUS: HARDENED" >> dl/ui_components/active_interface.kb
          
          echo "System coordinates reset and verified."
