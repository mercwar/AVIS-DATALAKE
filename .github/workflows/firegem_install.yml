name: FIREGEM-INSTALLATION

on:
  workflow_dispatch:

jobs:
  firegem-install:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Create DL Structure
        run: |
          mkdir -p dl/comments
          mkdir -p dl/ui_components
          mkdir -p dl/logs

          echo "AVIS_Map:
  Memory_Sectors:
    CYHY: 0x5000
    FIREGEM: 0x7000
    FVS: 0x9000
  Description: \"AVIS Datalake Memory Registry\"" > dl/avis_map.yml

          echo "FireGem_State:
  Initialization: \"COMPLETE\"
  Zero_State_File: \"kb_packets/initial_launch.kb\"
  Action: \"WAIT_FOR_BGIN\"
  Memory_Gate: 0x7000" > dl/firegem_registry.yml

          echo "CYHY_Reference:
  Sensors:
    - NAV_IMU_01
    - NAV_LIDAR_01
  Commands:
    MOVE_FORWARD: 0xA100
    TURN_LEFT: 0xA110
    REPORT_SUCCESS: 0xA200" > dl/cyhy_ref.yml

          touch dl/comments/.placeholder
          touch dl/ui_components/.placeholder
          touch dl/logs/.placeholder

      - name: Package Initial Launch KB
        run: |
          mkdir -p kb_packets
          zip -r initial_launch.zip dl
          mv initial_launch.zip kb_packets/initial_launch.kb

      - name: Compile FireGem Unzipper
        run: |
          gcc src/core/firegem_unzip.c -o firegem_unzip

      - name: Install Initial Launch KB
        run: |
          ./firegem_unzip kb_packets/initial_launch.kb

      - name: Commit Installed DL Structure
        run: |
          git config user.name "FireGem Installer"
          git config user.email "installer@firegem.local"
          git add dl/
          git commit -m "FireGem Initial Launch Installed" || echo "No changes"
          git push || echo "Push skipped (no changes)"
