name: FireGem - Automatic KB Fire
on:
  push:
    paths:
      - 'kb_packets/*.kb'

jobs:
  auto-fire-deployment:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: KB Ingestion & ASM Fire
        env:
          MERC_G_PAT: ${{ secrets.MERC_G_PAT }}
        run: |
          # 1. Locate the newest KB packet
          LATEST_KB=$(ls -t kb_packets/*.kb | head -1)
          
          # 2. Extract and Unzip using the 'FireGem' protocol
          # We use base64 -d as the primary unzip tool
          base64 -d $LATEST_KB > extracted_logic.tmp
          
          # 3. Call the pre-compiled ASM stub to signal the Fire Sector
          # This 'flashes' the logic into the datalake at the system level
          ./src/core/fire_stubs.so --ignite extracted_logic.tmp
          
          # 4. Clean up and confirm
          rm extracted_logic.tmp
          echo "FIREGEM: KB Deployment Successful."
