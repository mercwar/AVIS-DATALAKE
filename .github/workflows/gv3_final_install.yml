name: Gemini V3 - Cloning Power Installation
on:
  push:
    paths:
      - 'kb_packets/initial_launch.kb'

jobs:
  v3-expansion:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    env:
      MERC_G_PAT: ${{ secrets.MERC_G_PAT }}
    steps:
      - name: 1. Checkout AVIS-DATALAKE
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.MERC_G_PAT }}

      - name: 2. Build Sector Loader
        run: gcc src/core/firegem_kb_loader.c -o loader

      - name: 3. FVS_IO:CLONE_V3_REPO_CORE
        run: |
          # AVIS_IO:FVS_MKDIR_P - Build the Version 2 Bridge
          mkdir -p "GEMINI/VERSION 2/"
          
          # AVIS_IO:FVS_READ_KB - Decode G-V3 Launch Sequence into V2
          ./loader kb_packets/initial_launch.kb "GEMINI/VERSION 2/gv3_bridge.c"
          
          # AVIS_IO:FVS_CLONE - CLONE THE FULL REPO AS VERSION 3
          # This installs the cloning power directly to the sector
          git clone "https://x-access-token:${MERC_G_PAT}@://github.com" "GEMINI/VERSION 3"

      - name: 4. FVS_IO:PUSH_TO_SURFACE
        run: |
          git config --global user.name "FireGem-Bot"
          git config --global user.email "bot@firegem.ai"
          git add "GEMINI/VERSION 2/"
          git add "GEMINI/VERSION 3/"
          git commit -m "FVS_IO: Materialize V2 Bridge and V3 Repo-Core" || echo "No changes"
          git push
