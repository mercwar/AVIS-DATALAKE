 - name: Install Dependencies
        run: sudo apt-get install -y nasm gcc

      - name: Compile FireGem KB Loader
        run: gcc src/core/firegem_kb_loader.c -o firegem_kb_loader

      - name: FVS_IO:BOOT_CHAIN (Initial Launch)
        if: hashFiles('kb_packets/initial_launch.kb') != ''
        run: |
          # 1. Prep AVIS Runtime Surfaces
          mkdir -p dl/runtime dl/ui_components dl/comments dl/logs
          
          # 2. Clean and Decode initial_launch.kb into boot.c
          # tr removes any stray tags or newlines that cause "invalid input"
          cat kb_packets/initial_launch.kb | tr -dc 'A-Za-z0-9+/=' > boot_clean.kb
          ./firegem_kb_loader boot_clean.kb dl/runtime/boot.c
          
          # 3. Compile and Execute the Boot Program
          gcc dl/runtime/boot.c -o firegem_boot
          ./firegem_boot

      - name: FVS_IO:UI_UPDATE (Latest KB)
        if: hashFiles('kb_packets/latest.kb') != ''
        run: |
          # 1. Clean and Decode latest.kb into ui_engine.c
          cat kb_packets/latest.kb | tr -dc 'A-Za-z0-9+/=' > latest_clean.kb
          ./firegem_kb_loader latest_clean.kb dl/runtime/ui_engine.c
          
          # 2. Compile and Execute the UI Engine
          gcc dl/runtime/ui_engine.c -o ui_engine
          ./ui_engine
